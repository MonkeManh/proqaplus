(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8770],{555:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>O});var r=n(5155),l=n(7168),a=n(8482),s=n(1793),o=n(70),i=n(9852),c=n(5784),u=n(9401),d=n(221),m=n(2115),f=n(2177),p=n(5594);let h=e=>{let t=new Date(e);if(isNaN(t.getTime()))return{value:0,unit:"Years"};let n=new Date,r=n.getFullYear()-t.getFullYear(),l=n.getMonth()-t.getMonth(),a=n.getDate()-t.getDate();if(r>1||1===r&&(l>0||0===l&&a>=0))return{value:r,unit:"Years"};let s=12*r+l+(a<0?-1:0);return s>=1?{value:s,unit:"Months"}:{value:Math.floor((n.getTime()-t.getTime())/864e5),unit:"Days"}},x=e=>!isNaN(new Date(e).getTime()),g=p.z.object({patientProximity:p.z.enum(["Yes","No","First Party","Fourth Party (Referral)"],{required_error:"Please select an option"}),patientCount:p.z.coerce.number().min(1,"Must be at least 1").max(99,"Must be less than 100"),patientAge:p.z.coerce.number().min(0,"Must be a positive number"),ageUnit:p.z.enum(["Years","Months","Days"],{required_error:"Please select an age unit"}),gender:p.z.enum(["Male","Female","Unknown"],{required_error:"Please select a gender"}),isConscious:p.z.enum(["Yes","No","Unknown"],{required_error:"Please select an option"}),isBreathing:p.z.enum(["Yes","No","INEFFECTIVE/AGONAL","Unknown"],{required_error:"Please select an option"}),chiefComplaint:p.z.string({required_error:"Please select a complaint"})});function v(e){let{onContinue:t}=e,[n,p]=(0,m.useState)(!1),[v,j]=(0,m.useState)(!1),[b,S]=(0,m.useState)(""),y=(0,m.useRef)(null),C=(0,m.useRef)(null),N=(0,m.useRef)(null),A=(0,m.useRef)(null),w=(0,m.useRef)(null),E=(0,m.useRef)(null);(0,m.useEffect)(()=>{y.current&&(y.current.focus(),y.current.click(),j(!0))},[]);let I=(0,f.mN)({resolver:(0,d.u)(g),defaultValues:{patientProximity:"Yes",patientCount:1,patientAge:0,ageUnit:"Years",gender:void 0,isConscious:void 0,isBreathing:void 0,chiefComplaint:""}}),k=I.watch("gender"),D=e=>{switch(e){case"Male":return"he";case"Female":return"she";case"Unknown":return"they"}},P=I.watch("isBreathing"),_=I.watch("isConscious"),T=(0,m.useMemo)(()=>{let e=(0,u.p)();if("No"===P||"INEFFECTIVE/AGONAL"===P){let t=[9,11,12,14,15],n=e.filter(e=>t.includes(e.protocol)),r=e.filter(e=>!t.includes(e.protocol));return n.sort((e,n)=>t.indexOf(e.protocol)-t.indexOf(n.protocol)),[...n.map(e=>({value:"".concat(e.protocol," - ").concat(e.value),label:"".concat(e.protocol," - ").concat(e.label),className:"bg-red-500/20 hover:bg-red-500/40 transition-colors"})),...r.map(e=>({value:"".concat(e.protocol," - ").concat(e.value),label:"".concat(e.protocol," - ").concat(e.value)}))]}if("No"===_){let t=[31,9,11,12,14,15],n=e.filter(e=>t.includes(e.protocol)),r=e.filter(e=>!t.includes(e.protocol));return n.sort((e,n)=>t.indexOf(e.protocol)-t.indexOf(n.protocol)),[...n.map(e=>({value:"".concat(e.protocol," - ").concat(e.value),label:"".concat(e.protocol," - ").concat(e.label),className:"bg-red-500/20 hover:bg-red-500/40 transition-colors"})),...r.map(e=>({value:"".concat(e.protocol," - ").concat(e.value),label:"".concat(e.protocol," - ").concat(e.value)}))]}return e.map(e=>({value:"".concat(e.protocol," - ").concat(e.value),label:"".concat(e.protocol," - ").concat(e.value)}))},[P,_]);return(0,m.useEffect)(()=>{let e=I.watch((e,t)=>{let{name:n}=t,r=I.getValues();if(p(!!(r.patientProximity&&r.patientCount&&void 0!==r.patientAge&&r.ageUnit&&r.gender&&r.isConscious&&r.isBreathing&&r.chiefComplaint)),"patientProximity"===n&&e.patientProximity){var l;null==(l=C.current)||l.focus()}"gender"===n&&e.gender?setTimeout(()=>{var e;null==(e=N.current)||e.click()},100):"isConscious"===n&&e.isConscious?setTimeout(()=>{var e;null==(e=A.current)||e.click()},100):"isBreathing"===n&&e.isBreathing?setTimeout(()=>{var e;null==(e=w.current)||e.focus()},100):"chiefComplaint"===n&&e.chiefComplaint&&setTimeout(()=>{var e;null==(e=E.current)||e.focus()},100)});return()=>e.unsubscribe()},[I]),(0,r.jsxs)(a.Zp,{className:"max-w-5xl mx-auto h-fit w-full",children:[(0,r.jsx)(a.aR,{children:(0,r.jsx)(a.ZB,{className:"text-2xl",children:"Case Entry"})}),(0,r.jsx)(a.Wu,{children:(0,r.jsx)("div",{className:"space-y-6",children:(0,r.jsx)(o.lV,{...I,children:(0,r.jsxs)("form",{onSubmit:I.handleSubmit(e=>{let n={age:e.patientAge,ageUnit:e.ageUnit,gender:e.gender,count:e.patientCount,isConscious:e.isConscious,isBreathing:e.isBreathing};localStorage.setItem("PATIENT_DATA",JSON.stringify(n));let r=e.chiefComplaint.split(" - ");t(r.length>1?r[1]:e.chiefComplaint,e,!1)}),className:"space-y-6",children:[(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(o.zB,{control:I.control,name:"patientProximity",render:e=>{let{field:t}=e;return(0,r.jsxs)(o.eI,{children:[(0,r.jsx)(o.lR,{children:"Are you with the patient now?"}),(0,r.jsxs)(c.l6,{onValueChange:t.onChange,defaultValue:t.value,children:[(0,r.jsx)(o.MJ,{children:(0,r.jsx)(c.bq,{ref:y,children:(0,r.jsx)(c.yv,{placeholder:"Select an option"})})}),(0,r.jsxs)(c.gC,{children:[(0,r.jsx)(c.eb,{value:"Yes",children:"Yes"}),(0,r.jsx)(c.eb,{value:"No",children:"No"}),(0,r.jsx)(c.eb,{value:"First Party",children:"First Party"}),(0,r.jsx)(c.eb,{value:"Fourth Party (Referral)",children:"Fourth Party (Referral)"})]})]})]})}}),(0,r.jsx)(o.zB,{control:I.control,name:"patientCount",render:e=>{let{field:t}=e;return(0,r.jsxs)(o.eI,{children:[(0,r.jsx)(o.lR,{children:"How many people are sick?"}),(0,r.jsx)(o.MJ,{children:(0,r.jsx)(i.p,{type:"number",min:1,max:99,...t,ref:C,onChange:e=>t.onChange(e.target.valueAsNumber||1)})}),(0,r.jsx)(o.C5,{})]})}}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsx)(o.zB,{control:I.control,name:"patientAge",render:e=>{let{field:t}=e;return(0,r.jsxs)(o.eI,{children:[(0,r.jsx)(o.lR,{children:"How old is the patient?"}),(0,r.jsx)(o.MJ,{children:(0,r.jsx)(i.p,{type:"text",value:b,onChange:e=>{let n=e.target.value.trim();S(n);let r=Number(n);(""===n||!isNaN(r)&&r>=0||x(n))&&t.onChange(isNaN(r)?0:r)},onBlur:()=>{let e=Number(b);if(x(b)){let e=h(b);t.onChange(e.value),I.setValue("ageUnit",e.unit),S(e.value.toString())}else if(isNaN(e)){if(""!==b){var n;S((null==(n=t.value)?void 0:n.toString())||"0")}}else t.onChange(e||0)},placeholder:"Age or Date (e.g., 1/1/2000)"})}),(0,r.jsx)(o.C5,{})]})}}),(0,r.jsx)(o.zB,{control:I.control,name:"ageUnit",render:e=>{let{field:t}=e;return(0,r.jsxs)(o.eI,{tabIndex:-1,children:[(0,r.jsx)(o.lR,{children:"\xa0"}),(0,r.jsxs)(c.l6,{onValueChange:t.onChange,defaultValue:t.value,value:t.value,children:[(0,r.jsx)(o.MJ,{children:(0,r.jsx)(c.bq,{children:(0,r.jsx)(c.yv,{placeholder:"Select unit"})})}),(0,r.jsxs)(c.gC,{children:[(0,r.jsx)(c.eb,{value:"Years",children:"Years"}),(0,r.jsx)(c.eb,{value:"Months",children:"Months"}),(0,r.jsx)(c.eb,{value:"Days",children:"Days"})]})]}),(0,r.jsx)(o.C5,{})]})}})]}),(0,r.jsx)(o.zB,{control:I.control,name:"gender",render:e=>{let{field:t}=e;return(0,r.jsxs)(o.eI,{children:[(0,r.jsx)(o.lR,{children:"What is the patient's gender?"}),(0,r.jsxs)(c.l6,{onValueChange:t.onChange,defaultValue:t.value,children:[(0,r.jsx)(o.MJ,{children:(0,r.jsx)(c.bq,{children:(0,r.jsx)(c.yv,{placeholder:"Select gender"})})}),(0,r.jsxs)(c.gC,{children:[(0,r.jsx)(c.eb,{value:"Male",children:"Male"}),(0,r.jsx)(c.eb,{value:"Female",children:"Female"}),(0,r.jsx)(c.eb,{value:"Unknown",children:"Unknown"})]})]}),(0,r.jsx)(o.C5,{})]})}}),(0,r.jsx)(o.zB,{control:I.control,name:"isConscious",render:e=>{let{field:t}=e;return(0,r.jsxs)(o.eI,{children:[(0,r.jsxs)(o.lR,{children:["Is ",v&&D(k)," awake (conscious)?"]}),(0,r.jsxs)(c.l6,{onValueChange:t.onChange,defaultValue:t.value,children:[(0,r.jsx)(o.MJ,{children:(0,r.jsx)(c.bq,{ref:N,children:(0,r.jsx)(c.yv,{placeholder:"Select an option"})})}),(0,r.jsxs)(c.gC,{children:[(0,r.jsx)(c.eb,{value:"Yes",children:"Yes"}),(0,r.jsx)(c.eb,{value:"No",children:"No"}),(0,r.jsx)(c.eb,{value:"Unknown",children:"Unknown"})]})]}),(0,r.jsx)(o.C5,{})]})}}),(0,r.jsx)(o.zB,{control:I.control,name:"isBreathing",render:e=>{let{field:t}=e;return(0,r.jsxs)(o.eI,{children:[(0,r.jsxs)(o.lR,{children:["Is ",v&&D(k)," breathing?"]}),(0,r.jsxs)(c.l6,{onValueChange:t.onChange,defaultValue:t.value,children:[(0,r.jsx)(o.MJ,{children:(0,r.jsx)(c.bq,{ref:A,children:(0,r.jsx)(c.yv,{placeholder:"Select an option"})})}),(0,r.jsxs)(c.gC,{children:[(0,r.jsx)(c.eb,{value:"Yes",children:"Yes"}),(0,r.jsx)(c.eb,{value:"INEFFECTIVE/AGONAL",children:"INEFFECTIVE/AGONAL"}),(0,r.jsx)(c.eb,{value:"No",children:"No"}),(0,r.jsx)(c.eb,{value:"Unknown",children:"Unknown"})]})]}),(0,r.jsx)(o.C5,{})]})}}),v&&(0,r.jsx)(o.zB,{control:I.control,name:"chiefComplaint",render:e=>{let{field:t}=e;return(0,r.jsxs)(o.eI,{children:[(0,r.jsx)(o.lR,{children:"Chief Complaint"}),(0,r.jsx)(o.MJ,{children:(0,r.jsx)(s.G,{options:T,value:t.value,onValueChange:t.onChange,placeholder:"Select chief complaint",searchPlaceholder:"Search complaints...",ref:w})}),(0,r.jsx)(o.Rr,{children:"Select the primary complaint or reason for the call"}),(0,r.jsx)(o.C5,{})]})}})]}),(0,r.jsx)("div",{className:"flex flex-row-reverse justify-start gap-2",children:v&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.$,{type:"submit",disabled:!n,ref:E,className:"cursor-pointer focus-visible:ring-red-600 focus-visible:ring-offset-2 focus-visible:outline-none",children:"Continue"}),(0,r.jsx)(l.$,{type:"button",variant:"destructive",className:"hover:bg-red-600 hover:border-red-500 font-bold cursor-pointer",disabled:!I.getValues().chiefComplaint,onClick:()=>{if(I.getValues().chiefComplaint){let e=I.getValues();localStorage.setItem("EMS_DATA",JSON.stringify(e));let n={age:e.patientAge,ageUnit:e.ageUnit,gender:e.gender,count:e.patientCount,isConscious:"Yes"===e.isConscious||"No"!==e.isConscious&&"Unknown",isBreathing:"Yes"===e.isBreathing||"No"!==e.isBreathing&&"INEFFECTIVE/AGONAL"!==e.isBreathing&&"Unknown"};localStorage.setItem("DISPATCH_PATIENT_DATA",JSON.stringify(n));let r=e.chiefComplaint.split(" - ");t(r.length>1?r[1]:e.chiefComplaint,e,!0)}},children:"ProQA Override"})]})})]})})})})]})}var j=n(2372),b=n(3999);function S(e){let{complaintName:t,recommendedCode:n,onSelect:s,onBack:o}=e,[i,c]=(0,m.useState)(null),[d,f]=(0,m.useState)([]),[p,h]=(0,m.useState)(n),[x,g]=(0,m.useState)(0),v=(0,m.useRef)(null),S=e=>{switch(e){case"O":return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300";case"A":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300";case"B":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300";case"C":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300";case"D":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300";case"E":return"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300"}},y=e=>e===n,C=e=>{let t=j.En.find(t=>t.id===e);return(null==t?void 0:t.incidentType)||"Plan ".concat(e)},N=(0,m.useCallback)((e,t,n)=>{h(e),s(e,t,n)},[s]);return((0,m.useEffect)(()=>{let e=u.g.find(e=>e.name===t);if(e&&e.availableDeterminants){c(e);let t=localStorage.getItem("EMS_PROQA_DATA"),r=t?JSON.parse(t):null,l=(null==r?void 0:r.currentSubType)?"".concat(r.currentCode).concat(r.currentSubType):n;h(l);let a=[];e.availableDeterminants.forEach(e=>{e.determinants.forEach(t=>{a.push({code:t.code,text:t.text,recResponse:t.recResponse,priority:e.priority}),t.subCodes&&t.subCodes.forEach(n=>{a.push({code:"".concat(t.code).concat(n.code),text:"".concat(t.text," - ").concat(n.text),recResponse:n.recResponse,priority:e.priority,isSubCode:!0,parendCode:t.code,parentText:t.text})})})}),f(a);let s=a.findIndex(e=>e.code===l);s>=0&&g(s)}},[t,n]),(0,m.useEffect)(()=>{let e=e=>{if(d.length){if("ArrowDown"===e.key)e.preventDefault(),g(e=>(e+1)%d.length);else if("ArrowUp"===e.key)e.preventDefault(),g(e=>(e-1+d.length)%d.length);else if("Enter"===e.key){e.preventDefault();let t=d[x];N(t.code,t.recResponse,t.text)}}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[d,x,N]),(0,m.useEffect)(()=>{if(v.current){let e=v.current.querySelectorAll(".determinant-item");e[x]&&e[x].scrollIntoView({behavior:"smooth",block:"center"})}},[x]),(0,m.useEffect)(()=>{v.current&&n&&setTimeout(()=>{var e;let t=null==(e=v.current)?void 0:e.querySelectorAll(".determinant-item"),r=Array.from(t||[]).findIndex(e=>{var t;return null==(t=e.textContent)?void 0:t.includes(n)});r>=0&&(null==t?void 0:t[r])&&t[r].scrollIntoView({behavior:"auto",block:"center"})},100)},[n,i]),i&&i.availableDeterminants)?(0,r.jsxs)(a.Zp,{className:"max-w-5xl mx-auto h-fit w-full",children:[(0,r.jsx)(a.aR,{children:(0,r.jsx)(a.ZB,{className:"text-2xl",children:"ProQA Questions"})}),(0,r.jsx)(a.Wu,{children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("h3",{className:"text-xl font-medium",children:["Select Determinant Code: ",i.name]}),(0,r.jsxs)("p",{className:"text-muted-foreground",children:["Recommended: ",n]})]}),(0,r.jsx)(a.Zp,{children:(0,r.jsx)(a.Wu,{className:"p-4",children:(0,r.jsx)("div",{ref:v,className:"overflow-y-auto",children:(0,r.jsx)("div",{className:"space-y-4",children:i.availableDeterminants.sort((e,t)=>e.priority.localeCompare(t.priority)).map(e=>(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("h3",{className:"text-md font-medium p-2 rounded-md ".concat(S(e.priority)),children:[e.priority," Level"]}),(0,r.jsx)("div",{className:"space-y-1",children:e.determinants.map(e=>{let t=d.findIndex(t=>t.code===e.code),n=y(e.code),l=p===e.code,a=x===t;return(0,r.jsxs)("div",{className:"space-y-0.5",children:[(0,r.jsxs)("div",{className:(0,b.cn)("determinant-item flex items-center gap-4 p-2 rounded-md",l?"bg-primary text-primary-foreground":a?"bg-green-500 text-white":"",n?"border-2 border-red-500":""),onClick:()=>{g(t),N(e.code,e.recResponse,e.text)},children:[(0,r.jsx)("span",{className:"font-mono font-medium w-16",children:e.code}),(0,r.jsx)("span",{className:"flex-1",children:e.text}),(0,r.jsx)("span",{className:"ml-2",children:C(e.recResponse)})]}),e.subCodes&&(0,r.jsx)("div",{className:"ml-6 space-y-0.5",children:e.subCodes.map(t=>{let n="".concat(e.code).concat(t.code),l=d.findIndex(e=>e.code===n),a=y(n),s=p===n,o=x===l;return(0,r.jsxs)("div",{className:(0,b.cn)("determinant-item flex items-center gap-4 p-1.5 rounded-md text-sm px-4",s?"bg-primary text-primary-foreground":o?"bg-green-500 text-white":"bg-muted/50",a?"border-2 border-green-500":""),onClick:()=>{g(l),N(n,t.recResponse,"".concat(e.text," - ").concat(t.text))},children:[(0,r.jsx)("span",{className:"font-mono font-medium w-4",children:t.code}),(0,r.jsx)("span",{className:"flex-1",children:t.text}),(0,r.jsx)("span",{className:"ml-2",children:C(t.recResponse)})]},n)})})]},e.code)})})]},e.priority))})})})}),(0,r.jsx)("div",{className:"flex justify-between",children:(0,r.jsx)(l.$,{variant:"outline",onClick:o,children:"Back"})})]})})]}):(0,r.jsx)("div",{children:"Loading determinants..."})}var y=n(5516),C=n(8996);let N=e=>{var t;switch((null==(t=e.match(/[A-E]/))?void 0:t[0])||""){case"E":return 5;case"D":return 4;case"C":return 3;case"B":return 2;case"A":return 1;default:return 0}},A=(e,t)=>{if(!e.availableDeterminants)return null;let n=null,r=!1;for(let n of e.availableDeterminants)for(let e of n.determinants)if(e.notBreathing&&!1===t.isBreathing)return{code:e.code,override:!0};for(let l of e.availableDeterminants)for(let e of l.determinants){if(e.notConscious&&!1===t.isConscious)return{code:e.code,override:!0};e.multVictim&&t.count>1&&!n&&(n=e.code,r=!0)}return n?{code:n,override:r}:null},w=e=>{if(!e.availableDeterminants)return"DEFAULT";let t="DEFAULT",n=6;for(let r of e.availableDeterminants)for(let e of r.determinants){let r=N(e.code);r<n&&(n=r,t=e.code)}return t},E=e=>{switch(e){case"Male":return"he";case"Female":return"she";default:return"the patient"}},I=e=>{if("string"==typeof e)return e;if(m.isValidElement(e)){let t="";return e.props.children&&m.Children.forEach(e.props.children,e=>{"string"==typeof e?t+=e:m.isValidElement(e)&&(t+=I(e))}),t}return""},k=(e,t)=>{if(!t)return!0;let n=N(t);return N(e)>n};function D(e){let{complaintName:t,patientData:n,onComplete:s,onBack:o,onSwitchProtocol:c}=e,[d,f]=(0,m.useState)(null),[p,h]=(0,m.useState)(0),[x,g]=(0,m.useState)(null),[v,j]=(0,m.useState)(0),[S,N]=(0,m.useState)(""),[D,P]=(0,m.useState)(0),[_,T]=(0,m.useState)(!1),[O,R]=(0,m.useState)(!1),[M,U]=(0,m.useState)([]),[B,F]=(0,m.useState)(""),[V,q]=(0,m.useState)(!1),[Q,Y]=(0,m.useState)(null),L=(0,m.useRef)(null),J=(0,m.useCallback)(e=>{let n={complaint:t,currentQuestion:p,selectedAnswers:e,currentCode:S,currentSubCode:B,currentPlan:D,determinant:S?B?"".concat(S).concat(B):S:"DEFAULT",protocol:null==d?void 0:d.name,startTime:localStorage.getItem("DISPATCH_PROQA_START")||new Date().toISOString()};localStorage.setItem("EMS_PROQA_ANSWERS",JSON.stringify(e)),localStorage.setItem("EMS_PROQA_DATA",JSON.stringify(n))},[t,p,S,B,D,null==d?void 0:d.name]),z=(0,m.useCallback)(()=>{if(!d)return;let e=p+1;if(e>=d.questions.length){R(!0),localStorage.removeItem("EMS_PROQA_DATA");return}h(e),g(null),j(0)},[d,p]);(0,m.useEffect)(()=>{let e=localStorage.getItem("EMS_PROQA_DATA");if(!e)return;let n=JSON.parse(e);n.complaint===t&&(h(n.currentQuestion),N(n.currentCode||""),P(n.currentPlan),F(n.currentSubCode||""))},[t]),(0,m.useEffect)(()=>{if(!O)return;let e=S,t=localStorage.getItem("EMS_PROQA_DATA"),n=t?JSON.parse(t):null;!e&&(null==n?void 0:n.currentCode)&&(e=n.currentCode),e&&"DEFAULT"!==e||(e=d?w(d):"DEFAULT"),s(e,e,B||(null==n?void 0:n.currentSubCode)||""),R(!1)},[O,S,B,D,s,d]),(0,m.useEffect)(()=>{let e=u.g.find(e=>e.name===t);if(!e)return;f(e),P(e.defaultPlan),h(0),g(null),j(0),N(""),P(e.defaultPlan),T(!1),R(!1),U([]),F("");let r=A(e,n);r&&(N(r.code),T(r.override))},[t,n]);let G=(0,m.useCallback)((e,t)=>{if(!d)return;let r=d.questions[p],l=null==r?void 0:r.answers[e];if(!r||!l)return;if(void 0!==l.goto){localStorage.removeItem("EMS_PROQA_DATA"),localStorage.removeItem("EMS_PROQA_ANSWERS"),h(0),g(null),j(0),N(""),P(0),T(!1),R(!1),U([]),F(""),c&&c(l.goto);return}if(g(e),l.input&&!t){q(!0),Y(e);return}let a=l.display.replace("{input}",t||l.answer),s=I(r.text),o={question:s.replace(/\*\*pronoun\*\*/g,E(n.gender)),defaultQuestion:s,defaultAnswer:l.answer,answer:a,questionIndex:p,omit:r.omitQuestion||!1,timestamp:new Date().toISOString()},i=[...M],u=i.findIndex(e=>e.questionIndex===p);u>=0?i[u]=o:i.push(o),U(i);let m=A(d,n);if(m&&m.override&&(N(m.code),T(!0)),l.updateSubCode&&F(l.updateSubCode),l.dependency){console.log("Checking dependency with answers:",M);let e=(0,y.xT)(l.dependency,n,M);console.log("Dependency result:",e),e&&(e.code&&N(e.code),e.subCode&&F(e.subCode),e.plan&&P(e.plan),e.override&&T(!0))}if(l.updateCode&&!_&&(l.override||k(l.updateCode,S))&&(N(l.updateCode),l.override&&T(!0)),J(i),g(e),l.end){R(!0),localStorage.removeItem("EMS_PROQA_DATA");return}l.continue&&z()},[d,p,n,M,_,S,c,z,J]);if((0,m.useEffect)(()=>{let e=e=>{if(!d||V)return;let t=d.questions[p];if(!t||"select"!==t.questionType)return;let n=t.answers.length;"ArrowDown"===e.key?(e.preventDefault(),j(e=>(e+1)%n)):"ArrowUp"===e.key?(e.preventDefault(),j(e=>(e-1+n)%n)):"Enter"===e.key&&(e.preventDefault(),G(v))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[d,p,v,V,G]),(0,m.useEffect)(()=>{if(L.current){let e=L.current.querySelectorAll(".answer-option");e[v]&&e[v].scrollIntoView({behavior:"smooth",block:"nearest"})}},[v]),!d||O)return null;let W=d.questions[p];return W?(()=>{if(!d)return!1;let e=d.questions[p];return!!e&&(!e.preRenderInstructions||(0,y.U8)(e.preRenderInstructions,n,M,S))})()?(0,r.jsxs)(a.Zp,{className:"max-w-5xl mx-auto h-fit w-full",children:[(0,r.jsx)(a.aR,{children:(0,r.jsx)(a.ZB,{className:"text-2xl",children:"ProQA Questions"})}),(0,r.jsx)(a.Wu,{children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("h3",{className:"text-lg text-muted-foreground font-medium",children:["ProQA Protocol: ",d.name]}),(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Question ",p+1," of"," ",d.questions.length]})]}),(0,r.jsx)(a.Zp,{children:(0,r.jsxs)(a.Wu,{className:"p-6",children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("h4",{className:"text-lg font-medium mb-4",children:(0,y.DD)(W.text,E(n.gender))}),"select"===W.questionType?(0,r.jsx)("div",{ref:L,className:"space-y-2 overflow-y-auto",children:W.answers.map((e,t)=>(0,r.jsx)("div",{onClick:()=>G(t),className:(0,b.cn)("answer-option p-3 rounded-md transition-colors cursor-pointer",x===t?"bg-primary text-primary-foreground":v===t?"bg-green-500 text-white":"bg-muted hover:bg-muted/80"),children:e.answer},t))}):"input"===W.questionType&&(0,r.jsx)("form",{onSubmit:e=>{e.preventDefault();let t=e.currentTarget.querySelector("input");t&&t.value&&(G(0,t.value),t.value="")},children:(0,r.jsx)(i.p,{placeholder:W.answers[0].answer,autoFocus:!0})})]}),(0,r.jsx)("div",{className:"flex justify-between mt-8",children:(0,r.jsx)(l.$,{variant:"outline",onClick:()=>{p>0?(h(p-1),g(null),j(0)):o()},className:"text-sm",children:p>0?"Previous Question":"Back to Case Entry"})})]})})]})}),(0,r.jsx)(C.M,{isOpen:V,onClose:()=>{q(!1),Y(null),g(null)},onSubmit:e=>{q(!1),Y(null),null!==Q&&G(Q,e)},title:W?I(W.text).replace(/\*\*pronoun\*\*/g,E(n.gender)):""})]}):(z(),null):(R(!0),null)}var P=n(7746),_=n(4865),T=n(5695);function O(){let e=(0,T.useRouter)(),[t,n]=(0,m.useState)({postal:"",street:"",buildingInfo:"",crossStreet1:"",crossStreet2:"",callerNumber:"",callerName:"",callerText:"",service:"EMS"}),[l,a]=(0,m.useState)(1),[s,o]=(0,m.useState)(""),[i,c]=(0,m.useState)("");(0,m.useEffect)(()=>{let t=localStorage.getItem("NEW_CALL");if(!t)return e.push("/create-call");let r=JSON.parse(t);if(!r||"EMS"!==r.service)return e.push("/create-call");n(r)},[e]);let d=()=>{l>1?a(l-1):e.push("/create-call")},f=()=>{let e=localStorage.getItem("PATIENT_DATA");if(!e)return{age:0,ageUnit:"Years",gender:"Unknown",isConscious:"Unknown",isBreathing:"Unknown",patientProximity:"Yes",count:1};let t=JSON.parse(e);return{age:t.age,ageUnit:t.ageUnit,gender:t.gender,isConscious:"Unknown"===t.isConscious?"Unknown":"Yes"===t.isConscious,isBreathing:"Unknown"===t.isBreathing?"Unknown":"Yes"===t.isBreathing,patientProximity:t.patientProximity,count:t.count}},p=()=>{let e=localStorage.getItem("EMS_PROQA_ANSWERS");if(e)return JSON.parse(e)},h=(e,t)=>{let n=["O","A","B","C","D","E"],r=e.charAt(2),l=t.charAt(2);return n.indexOf(r)<n.indexOf(l)},x=async(n,r,l)=>{let[a,o]=await Promise.all([f(),p()]);localStorage.removeItem("PATIENT_DATA"),localStorage.removeItem("EMS_PROQA_DATA"),localStorage.removeItem("EMS_PROQA_ANSWERS");let i=localStorage.getItem("PREFERENCES");if((i?JSON.parse(i):{}).advancedMode){let i={...t,complaint:s,code:n,codeText:l,plan:r,patient:a,proqaAnswers:o,timestamp:new Date().toISOString()};localStorage.setItem("PENDING_ASSIGN_EMS",JSON.stringify(i)),e.push("/assign/ems")}else{var c;let i={...t,complaint:s,complaintShort:null==(c=u.g.find(e=>e.name===s))?void 0:c.shortName,code:n,codeText:l,plan:r,patient:a,proqaAnswers:o,timestamp:new Date().toISOString(),units:["Pending"],dispatchTime:new Date().toISOString()};localStorage.setItem("DISPATCH_HISTORY",JSON.stringify(i)),e.push("/summary/ems")}};return(0,r.jsxs)("div",{className:"flex flex-col min-h-screen",children:[(0,r.jsx)(_.A,{}),(0,r.jsxs)("main",{className:"w-full flex justify-center flex-1 mt-12",children:[1===l&&(0,r.jsx)(v,{onContinue:(e,t,n)=>(o(e),a(n?3:2))}),2===l&&(0,r.jsx)(D,{complaintName:s,patientData:f(),onComplete:(e,t,n)=>{let r=t&&n?"".concat(t).concat(n):e;(!i||h(r,i))&&c(r),r&&"DEFAULT"!==r&&a(3)},onBack:d,onSwitchProtocol:e=>{let n=u.g.find(t=>t.protocol===e);n&&(t.reconfigured=s,localStorage.removeItem("EMS_PROQA_DATA"),localStorage.removeItem("EMS_PROQA_QUESTIONS"),o(n.name))}}),3===l&&(0,r.jsx)(S,{complaintName:s,recommendedCode:i,onSelect:x,onBack:d})]}),(0,r.jsx)(P.A,{})]})}},1469:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{default:function(){return i},getImageProps:function(){return o}});let r=n(8229),l=n(8883),a=n(3063),s=r._(n(1193));function o(e){let{props:t}=(0,l.getImgProps)(e,{defaultLoader:s.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!0}});for(let[e,n]of Object.entries(t))void 0===n&&delete t[e];return{props:t}}let i=a.Image},2660:(e,t,n)=>{Promise.resolve().then(n.bind(n,555))},5028:(e,t,n)=>{"use strict";n.d(t,{default:()=>l.a});var r=n(6645),l=n.n(r)},5516:(e,t,n)=>{"use strict";n.d(t,{DD:()=>function e(t,n){if("string"==typeof t)return t.replace(/\*\*pronoun\*\*/g,n);if(Array.isArray(t))return t.map((t,a)=>(0,r.jsx)(l.Fragment,{children:e(t,n)},a));if((0,l.isValidElement)(t)){let r=e(t.props.children,n);return l.cloneElement(t,{...t.props},r)}return t},U8:()=>a,U_:()=>s,xT:()=>o,xV:()=>i});var r=n(5155),l=n(2115);function a(e,t,n,r){if(!e)return!0;try{return e(t,n,r)}catch(e){return console.error("Error evaluating pre-render instructions:",e),!0}}function s(e,t,n){if(!e)return!0;try{return e(t,n)}catch(e){return console.error("Error evaluating pre-render instructions:",e),!0}}function o(e,t,n){if(e)try{return e(t,n)}catch(e){console.error("Error evaluating dependencies:",e);return}}function i(e,t){if(e)try{return e(t)}catch(e){console.error("Error evaluating dependencies:",e);return}}},6645:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return l}});let r=n(8229)._(n(7357));function l(e,t){var n;let l={};"function"==typeof e&&(l.loader=e);let a={...l,...t};return(0,r.default)({...a,modules:null==(n=a.loadableGenerated)?void 0:n.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},6766:(e,t,n)=>{"use strict";n.d(t,{default:()=>l.a});var r=n(1469),l=n.n(r)},7357:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i}});let r=n(5155),l=n(2115),a=n(2146);function s(e){return{default:e&&"default"in e?e.default:e}}n(255);let o={loader:()=>Promise.resolve(s(()=>null)),loading:null,ssr:!0},i=function(e){let t={...o,...e},n=(0,l.lazy)(()=>t.loader().then(s)),i=t.loading;function c(e){let s=i?(0,r.jsx)(i,{isLoading:!0,pastDelay:!0,error:null}):null,o=!t.ssr||!!t.loading,c=o?l.Suspense:l.Fragment,u=t.ssr?(0,r.jsxs)(r.Fragment,{children:[null,(0,r.jsx)(n,{...e})]}):(0,r.jsx)(a.BailoutToCSR,{reason:"next/dynamic",children:(0,r.jsx)(n,{...e})});return(0,r.jsx)(c,{...o?{fallback:s}:{},children:u})}return c.displayName="LoadableComponent",c}},8996:(e,t,n)=>{"use strict";n.d(t,{M:()=>i});var r=n(5155),l=n(7168),a=n(9840),s=n(9852),o=n(2115);function i(e){let{isOpen:t,onClose:n,onSubmit:i,title:c}=e,[u,d]=(0,o.useState)(""),m=e=>{e.preventDefault(),u.trim()&&(i(u.trim()),d(""),n())};return(0,r.jsx)(a.lG,{open:t,onOpenChange:n,children:(0,r.jsxs)(a.Cf,{children:[(0,r.jsx)(a.c7,{children:(0,r.jsx)(a.L3,{children:c})}),(0,r.jsxs)("form",{onSubmit:m,children:[(0,r.jsx)(s.p,{value:u,onChange:e=>d(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),m(e))},placeholder:"Enter description...",autoFocus:!0}),(0,r.jsx)(a.Es,{className:"mt-4",children:(0,r.jsx)(l.$,{type:"submit",children:"Ok"})})]})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[4619,6580,9726,4977,8045,7423,9991,5916,8441,1684,7358],()=>t(2660)),_N_E=e.O()}]);