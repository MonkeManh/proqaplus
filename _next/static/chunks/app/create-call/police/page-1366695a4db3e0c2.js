(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8137],{1469:(e,t,l)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var l in t)Object.defineProperty(e,l,{enumerable:!0,get:t[l]})}(t,{default:function(){return i},getImageProps:function(){return o}});let n=l(8229),r=l(8883),a=l(3063),s=n._(l(1193));function o(e){let{props:t}=(0,r.getImgProps)(e,{defaultLoader:s.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!0}});for(let[e,l]of Object.entries(t))void 0===l&&delete t[e];return{props:t}}let i=a.Image},1969:(e,t,l)=>{"use strict";l.d(t,{A:()=>s});var n=l(5155),r=l(3999);function a(e){let{className:t,size:l="md"}=e;return(0,n.jsx)("div",{className:(0,r.cn)("animate-spin rounded-full border-solid border-primary border-t-transparent",{sm:"h-4 w-4 border-2",md:"h-8 w-8 border-3",lg:"h-12 w-12 border-4"}[l],t)})}function s(){return(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[50vh] p-4",children:[(0,n.jsx)(a,{size:"lg",className:"mb-4"}),(0,n.jsx)("h2",{className:"text-2xl font-semibold mb-2",children:"Loading"}),(0,n.jsx)("p",{className:"text-muted-foreground text-center max-w-md",children:"Please wait while we prepare the ProQA Plus content for you..."})]})}},2305:(e,t,l)=>{Promise.resolve().then(l.bind(l,5234))},5028:(e,t,l)=>{"use strict";l.d(t,{default:()=>r.a});var n=l(6645),r=l.n(n)},5234:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>T});var n=l(5155),r=l(7918),a=l(7168),s=l(8482),o=l(1793),i=l(70),c=l(221),d=l(2115),u=l(2177),m=l(5594);let h=m.z.object({chiefComplaint:m.z.string({required_error:"Please select a chief complaint"})});function x(e){let{onContinue:t,handleBack:l}=e,m=(0,d.useRef)(null),x=(0,d.useRef)(null),p=(0,r.M)().map(e=>({value:"".concat(e.protocol," - ").concat(e.value),label:"".concat(e.protocol," - ").concat(e.value)})),f=(0,u.mN)({resolver:(0,c.u)(h),defaultValues:{chiefComplaint:""}});return(0,d.useEffect)(()=>{let e=f.watch((e,t)=>{let{name:l}=t;"chiefComplaint"===l&&setTimeout(()=>{var e;null==(e=x.current)||e.focus()},100)});return()=>e.unsubscribe()},[f]),(0,n.jsxs)(s.Zp,{className:"max-w-5xl mx-auto h-fit w-full",children:[(0,n.jsx)(s.aR,{children:(0,n.jsx)(s.ZB,{className:"text-2xl",children:"Case Entry"})}),(0,n.jsx)(s.Wu,{children:(0,n.jsx)("div",{className:"space-y-8",children:(0,n.jsx)(i.lV,{...f,children:(0,n.jsxs)("form",{onSubmit:f.handleSubmit(e=>{let l={chiefComplaint:e.chiefComplaint},n=e.chiefComplaint.split(" - ");t(n.length>1?n[1]:e.chiefComplaint,l,!1)}),className:"space-y-8",children:[(0,n.jsx)("div",{className:"space-y-6",children:(0,n.jsx)(i.zB,{control:f.control,name:"chiefComplaint",render:e=>{let{field:t}=e;return(0,n.jsxs)(i.eI,{children:[(0,n.jsx)(i.lR,{children:"Chief Complaint"}),(0,n.jsx)(i.Rr,{className:"mb-1",children:"Select the primary complaint or reason for the call"}),(0,n.jsx)(i.MJ,{children:(0,n.jsx)(o.G,{options:p,value:t.value,onValueChange:t.onChange,placeholder:"Select chief complaint",searchPlaceholder:"Search complaints...",ref:m,autoFocus:!0})}),(0,n.jsx)(i.C5,{})]})}})}),(0,n.jsxs)("div",{className:"w-full flex flex-row-reverse justify-between mb-12 mt-10",children:[(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsx)(a.$,{type:"button",variant:"destructive",className:"cursor-pointer",onClick:()=>{let e=f.getValues().chiefComplaint;if(e){let l=e.split(" - "),n=l.length>1?l[1]:e;t(n,{chiefComplaint:n},!0)}},children:"ProQA Override"}),(0,n.jsx)(a.$,{type:"submit",ref:x,variant:"outline",className:"hover:bg-red-600 focus-visible:ring-red-600 focus-visible:ring-offset-2 focus-visible:outline-none",children:"Continue"})]}),(0,n.jsx)(a.$,{onClick:l,type:"button",variant:"outline",children:"Back"})]})]})})})})]})}var p=l(4328),f=l(3999),g=l(1969);let v=e=>{let t=p.lM.find(t=>t.id===e);return(null==t?void 0:t.incidentType)||"Plan ".concat(e)},j=e=>{switch(e){case"O":return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300";case"A":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300";case"B":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300";case"C":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300";case"D":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300";case"E":return"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300"}};function b(e){let{complaintName:t,recommendedCode:l,onSelect:o,onBack:i}=e,[c,u]=(0,d.useState)(null),[m,h]=(0,d.useState)([]),[x,p]=(0,d.useState)(l),[b,y]=(0,d.useState)(0),C=(0,d.useRef)(null),N=e=>e===l,S=(0,d.useCallback)((e,t,l)=>{p(e),o(e,t,l)},[o]);return((0,d.useEffect)(()=>{let e=r.A.find(e=>e.name===t);if(e&&e.availableDeterminants){u(e);let t=localStorage.getItem("FIRE_PROQA_DATA"),n=t?JSON.parse(t):null,r=(null==n?void 0:n.currentSubType)?"".concat(n.currentCode).concat(n.currentSubType):l;p(r);let a=[];e.availableDeterminants.forEach(e=>{e.determinants.forEach(t=>{a.push({code:t.code,text:t.text,recResponse:t.recResponse,priority:e.priority}),t.subCodes&&t.subCodes.forEach(l=>{a.push({code:"".concat(t.code).concat(l.code),text:"".concat(t.text," - ").concat(l.text),recResponse:l.recResponse,priority:e.priority,isSubCode:!0,parendCode:t.code,parentText:t.text})})})}),h(a);let s=a.findIndex(e=>e.code===r);s>=0&&y(s)}},[t,l]),(0,d.useEffect)(()=>{let e=e=>{if(m.length){if("ArrowDown"===e.key)e.preventDefault(),y(e=>(e+1)%m.length);else if("ArrowUp"===e.key)e.preventDefault(),y(e=>(e-1+m.length)%m.length);else if("Enter"===e.key){e.preventDefault();let t=m[b];S(t.code,t.recResponse,t.text)}}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[m,b,S]),(0,d.useEffect)(()=>{if(C.current){let e=C.current.querySelectorAll(".determinant-item");e[b]&&e[b].scrollIntoView({behavior:"smooth",block:"center"})}},[b]),(0,d.useEffect)(()=>{if(C.current&&l){let e=C.current.querySelectorAll(".determinant-item"),t=Array.from(e).findIndex(e=>{var t;return null==(t=e.textContent)?void 0:t.includes(l)});t>=0&&e[t].scrollIntoView({behavior:"auto",block:"center"})}},[l,c]),c&&c.availableDeterminants)?(0,n.jsxs)(s.Zp,{className:"max-w-5xl mx-auto h-fit w-full",children:[(0,n.jsx)(s.aR,{children:(0,n.jsx)(s.ZB,{className:"text-2xl",children:"ProQA Questions"})}),(0,n.jsx)(s.Wu,{children:(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsxs)("h3",{className:"text-xl font-medium",children:["Select Determinant Code: ",c.name]}),(0,n.jsxs)("p",{className:"text-muted-foreground",children:["Recommended: ",l]})]}),(0,n.jsx)(s.Zp,{children:(0,n.jsx)(s.Wu,{className:"p-4",children:(0,n.jsx)("div",{ref:C,className:"overflow-y-auto",children:(0,n.jsx)("div",{className:"space-y-4",children:c.availableDeterminants.sort((e,t)=>e.priority.localeCompare(t.priority)).map(e=>(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("h3",{className:"text-md font-medium p-2 rounded-md ".concat(j(e.priority)),children:[e.priority," Level"]}),(0,n.jsx)("div",{className:"space-y-1",children:e.determinants.map(e=>{let t=m.findIndex(t=>t.code===e.code),l=N(e.code),r=x===e.code,a=b===t;return(0,n.jsxs)("div",{className:"space-y-0.5",children:[(0,n.jsxs)("div",{className:(0,f.cn)("determinant-item flex items-center gap-4 p-2 rounded-md",r?"bg-primary text-primary-foreground":a?"bg-green-500 text-white":"",l?"border-2 border-red-500":""),onClick:()=>{y(t),S(e.code,e.recResponse,e.text)},children:[(0,n.jsx)("span",{className:"font-mono font-medium w-16",children:e.code}),(0,n.jsx)("span",{className:"flex-1",children:e.text}),(0,n.jsx)("span",{className:"ml-2",children:v(e.recResponse)})]}),e.subCodes&&(0,n.jsx)("div",{className:"ml-6 space-y-0.5",children:e.subCodes.map(t=>{let l="".concat(e.code).concat(t.code),r=m.findIndex(e=>e.code===l),a=N(l),s=x===l,o=b===r;return(0,n.jsxs)("div",{className:(0,f.cn)("determinant-item flex items-center gap-4 p-1.5 rounded-md text-sm px-4",s?"bg-primary text-primary-foreground":o?"bg-green-500 text-white":"bg-muted/50",a?"border-2 border-green-500":""),onClick:()=>{y(r),S(l,t.recResponse,"".concat(e.text," - ").concat(t.text))},children:[(0,n.jsx)("span",{className:"font-mono font-medium w-4",children:t.code}),(0,n.jsx)("span",{className:"flex-1",children:t.text}),(0,n.jsx)("span",{className:"ml-2",children:v(t.recResponse)})]},l)})})]},e.code)})})]},e.priority))})})})}),(0,n.jsx)("div",{className:"flex justify-between",children:(0,n.jsx)(a.$,{variant:"outline",onClick:i,children:"Back"})})]})})]}):(0,n.jsx)(g.A,{})}var y=l(9852),C=l(5516),N=l(8996),S=l(9840);function w(e){let{isOpen:t,onClose:l,onSubmit:r,title:s}=e,[o,i]=(0,d.useState)([{make:"",model:"",year:"",color:"",occupied:"",licensePlate:"",other:""}]),c=e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),x(e))},u=e=>{i(o.filter((t,l)=>l!==e))},m=(e,t,l)=>{let n=[...o];n[e]={...n[e],[t]:l},i(n)},h=()=>{i([{make:"",model:"",year:"",color:"",occupied:"",licensePlate:"",other:""}])},x=e=>{e.preventDefault();let t=o.map(e=>"Vehicle: {Year:".concat(e.year?e.year:"Unk",", Make:").concat(e.make?e.make:"Unk",", Model:").concat(e.model?e.model:"Unk",", Color:").concat(e.color?e.color:"Unk",", LP:").concat(e.licensePlate?e.licensePlate:"Unk",", Occ:").concat(e.occupied?e.occupied:"Unk",", Other:").concat(e.other?e.other:"","}").trim()).join(" | ");t&&(r(t),h(),l())};return(0,n.jsx)(S.lG,{open:t,onOpenChange:l,children:(0,n.jsxs)(S.Cf,{className:"max-w-2xl",children:[(0,n.jsx)(S.c7,{children:(0,n.jsxs)(S.L3,{className:"flex justify-between items-center",children:[s,(0,n.jsx)(a.$,{type:"button",variant:"outline",onClick:()=>{i([...o,{make:"",model:"",year:"",color:"",occupied:"",licensePlate:"",other:""}])},children:"+ Add Vehicle"})]})}),(0,n.jsxs)("form",{onSubmit:x,className:"space-y-6",children:[o.map((e,t)=>(0,n.jsxs)("div",{className:"space-y-4",children:[t>0&&(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsxs)("h3",{className:"text-sm font-medium",children:["Vehicle ",t+1]}),(0,n.jsx)(a.$,{type:"button",variant:"ghost",className:"text-red-500 h-8",onClick:()=>u(t),children:"Remove"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm",children:"Color"}),(0,n.jsx)(y.p,{value:e.color,onChange:e=>m(t,"color",e.target.value),onKeyDown:e=>c(e),placeholder:"Vehicle color",autoFocus:0===t})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm",children:"Year"}),(0,n.jsx)(y.p,{value:e.year,onChange:e=>m(t,"year",e.target.value),onKeyDown:e=>c(e),placeholder:"Year"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm",children:"Make"}),(0,n.jsx)(y.p,{value:e.make,onChange:e=>m(t,"make",e.target.value),onKeyDown:e=>c(e),placeholder:"Vehicle make"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm",children:"Model"}),(0,n.jsx)(y.p,{value:e.model,onChange:e=>m(t,"model",e.target.value),onKeyDown:e=>c(e),placeholder:"Vehicle model"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm",children:"Occupied"}),(0,n.jsx)(y.p,{type:"number",value:e.occupied,onChange:e=>m(t,"occupied",e.target.value),onKeyDown:e=>c(e),placeholder:"Number of occupants"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm",children:"License Plate"}),(0,n.jsx)(y.p,{value:e.licensePlate,onChange:e=>m(t,"licensePlate",e.target.value),onKeyDown:e=>c(e),placeholder:"License plate"})]}),(0,n.jsxs)("div",{className:"col-span-2",children:[(0,n.jsx)("label",{className:"text-sm",children:"Other"}),(0,n.jsx)(y.p,{value:e.other,onChange:e=>m(t,"other",e.target.value),onKeyDown:e=>c(e),placeholder:"Additional details"})]})]})]},t)),(0,n.jsx)(S.Es,{children:(0,n.jsx)(a.$,{type:"submit",children:"Submit All"})})]})]})})}var A=l(5784);function O(e){let{isOpen:t,onClose:l,onSubmit:r,title:s}=e,o={race:"",gender:"",clothing:"",age:"",dob:"",demeanor:"",name:"",relationship:"",address:"",phoneNumber:"",height:"",weight:"",hair:"",otherCharacteristics:"",eyeColor:"",complexion:""},[i,c]=(0,d.useState)([o]),[u,m]=(0,d.useState)(0),h=(e,t,l)=>{let n=[...i];n[e]={...n[e],[t]:l},c(n)},x=e=>{e.preventDefault();let t=i.map(e=>"Subject: {Gender:".concat(e.gender,", Race:").concat(e.race,", Age:").concat(e.age,", DOB:").concat(e.dob,", Height:").concat(e.height,", Weight:").concat(e.weight,", Hair:").concat(e.hair,", EyeColor:").concat(e.eyeColor,", Complexion:").concat(e.complexion,", Clothing:").concat(e.clothing,", Demeanor:").concat(e.demeanor,", Name:").concat(e.name,", Relationship:").concat(e.relationship,", Address:").concat(e.address,", Phone:").concat(e.phoneNumber,", Other:").concat(e.otherCharacteristics,"}").trim()).join(" | ");t&&(r(t),c([o]),m(0),l())},p=e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),x(e))};return(0,n.jsx)(S.lG,{open:t,onOpenChange:l,children:(0,n.jsxs)(S.Cf,{className:"max-w-3xl",children:[(0,n.jsx)(S.c7,{children:(0,n.jsxs)(S.L3,{className:"flex justify-between items-center",children:[(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsx)("span",{children:s}),(0,n.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Subject ",u+1," of ",i.length]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(a.$,{type:"button",variant:"outline",size:"sm",onClick:()=>{u>0&&m(u-1)},disabled:0===u,children:"Previous"}),(0,n.jsx)(a.$,{type:"button",variant:"outline",size:"sm",onClick:()=>{u<i.length-1&&m(u+1)},disabled:u===i.length-1,children:"Next"}),(0,n.jsx)(a.$,{type:"button",variant:"outline",onClick:()=>{c([...i,o]),m(i.length)},children:"+ Add"}),i.length>1&&(0,n.jsx)(a.$,{type:"button",variant:"destructive",size:"sm",onClick:()=>{c(i.filter((e,t)=>t!==u)),m(Math.max(0,u-1))},children:"Remove"})]})]})}),(0,n.jsxs)("form",{onSubmit:x,className:"space-y-6",children:[(0,n.jsx)("div",{className:"space-y-4",children:(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm",children:"Race"}),(0,n.jsxs)(A.l6,{value:i[u].race,onValueChange:e=>h(u,"race",e),children:[(0,n.jsx)(A.bq,{children:(0,n.jsx)(A.yv,{placeholder:"Select race"})}),(0,n.jsxs)(A.gC,{children:[(0,n.jsx)(A.eb,{value:"White",children:"White"}),(0,n.jsx)(A.eb,{value:"Black",children:"Black"}),(0,n.jsx)(A.eb,{value:"Hispanic",children:"Hispanic"}),(0,n.jsx)(A.eb,{value:"Pacific Islander",children:"Pacific Islander"}),(0,n.jsx)(A.eb,{value:"Native American",children:"Native American"})]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm",children:"Gender"}),(0,n.jsxs)(A.l6,{value:i[u].gender,onValueChange:e=>h(u,"gender",e),children:[(0,n.jsx)(A.bq,{children:(0,n.jsx)(A.yv,{placeholder:"Select gender"})}),(0,n.jsxs)(A.gC,{children:[(0,n.jsx)(A.eb,{value:"Male",children:"Male"}),(0,n.jsx)(A.eb,{value:"Female",children:"Female"}),(0,n.jsx)(A.eb,{value:"Other",children:"Other"})]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm",children:"Clothing"}),(0,n.jsx)(y.p,{value:i[u].clothing,onChange:e=>h(u,"clothing",e.target.value),onKeyDown:e=>p(e),placeholder:"Clothing description"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm",children:"Age (Years)"}),(0,n.jsx)(y.p,{type:"number",value:i[u].age,onChange:e=>h(u,"age",e.target.value),onKeyDown:e=>p(e),placeholder:"Age"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm",children:"DOB"}),(0,n.jsx)(y.p,{type:"date",value:i[u].dob,onChange:e=>h(u,"dob",e.target.value),onKeyDown:e=>p(e)})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm",children:"Demeanor"}),(0,n.jsx)(y.p,{value:i[u].demeanor,onChange:e=>h(u,"demeanor",e.target.value),onKeyDown:e=>p(e),placeholder:"Demeanor"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm",children:"Name"}),(0,n.jsx)(y.p,{value:i[u].name,onChange:e=>h(u,"name",e.target.value),onKeyDown:e=>p(e),placeholder:"Full name"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm",children:"Relationship"}),(0,n.jsx)(y.p,{value:i[u].relationship,onChange:e=>h(u,"relationship",e.target.value),onKeyDown:e=>p(e),placeholder:"Relationship"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm",children:"Height"}),(0,n.jsx)(y.p,{value:i[u].height,onChange:e=>h(u,"height",e.target.value),onKeyDown:e=>p(e),placeholder:"Height"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm",children:"Weight"}),(0,n.jsx)(y.p,{value:i[u].weight,onChange:e=>h(u,"weight",e.target.value),onKeyDown:e=>p(e),placeholder:"Weight"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm",children:"Hair"}),(0,n.jsx)(y.p,{value:i[u].hair,onChange:e=>h(u,"hair",e.target.value),onKeyDown:e=>p(e),placeholder:"Hair color/length/style"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm",children:"Eye Color"}),(0,n.jsx)(y.p,{value:i[u].eyeColor,onChange:e=>h(u,"eyeColor",e.target.value),onKeyDown:e=>p(e),placeholder:"Eye color"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm",children:"Complexion"}),(0,n.jsx)(y.p,{value:i[u].complexion,onChange:e=>h(u,"complexion",e.target.value),onKeyDown:e=>p(e),placeholder:"Complexion"})]}),(0,n.jsxs)("div",{className:"col-span-2",children:[(0,n.jsx)("label",{className:"text-sm",children:"Other Characteristics"}),(0,n.jsx)(y.p,{value:i[u].otherCharacteristics,onChange:e=>h(u,"otherCharacteristics",e.target.value),onKeyDown:e=>p(e),placeholder:"Additional characteristics"})]})]})}),(0,n.jsx)(S.Es,{children:(0,n.jsxs)(a.$,{type:"submit",children:["Submit All (",i.length," subjects)"]})})]})]})})}let E=e=>{var t;switch((null==(t=e.match(/[A-E]/))?void 0:t[0])||""){case"E":return 5;case"D":return 4;case"C":return 3;case"B":return 2;case"A":return 1;default:return 0}},P=e=>{if(!e.availableDeterminants)return"DEFAULT";let t="DEFAULT",l=6;for(let n of e.availableDeterminants)for(let e of n.determinants){let n=E(e.code);n<l&&(l=n,t=e.code)}return t},k=e=>{if("string"==typeof e)return e;if(d.isValidElement(e)){let t="";return e.props.children&&d.Children.forEach(e.props.children,e=>{"string"==typeof e?t+=e:d.isValidElement(e)&&(t+=k(e))}),t}return""},D=(e,t)=>{if(!t)return!0;let l=E(t);return E(e)>l};function I(e){let{complaintName:t,onComplete:l,onBack:o,onSwitchProtocol:i}=e,[c,u]=(0,d.useState)(null),[m,h]=(0,d.useState)(0),[x,p]=(0,d.useState)(null),[g,v]=(0,d.useState)(0),[j,b]=(0,d.useState)(""),[S,A]=(0,d.useState)(0),[E,I]=(0,d.useState)(!1),[_,R]=(0,d.useState)(!1),[L,T]=(0,d.useState)([]),[Q,q]=(0,d.useState)(""),[K,V]=(0,d.useState)(!1),[U,B]=(0,d.useState)(!1),[F,M]=(0,d.useState)(!1),[W,$]=(0,d.useState)(null),[z,H]=(0,d.useState)([]),J=(0,d.useRef)(null),G=(0,d.useCallback)(e=>{let l={complaint:t,currentQuestion:m,selectedAnswers:e,currentCode:j,currentSubCode:Q,currentPlan:S,determinant:j?Q?"".concat(j).concat(Q):j:"DEFAULT",protocol:null==c?void 0:c.name,startTime:localStorage.getItem("DISPATCH_PROQA_START")||new Date().toISOString()};localStorage.setItem("POLICE_PROQA_ANSWERS",JSON.stringify(e)),localStorage.setItem("POLICE_PROQA_DATA",JSON.stringify(l))},[t,j,m,S,Q,null==c?void 0:c.name]),Z=(0,d.useCallback)(()=>{if(!c)return;let e=m+1;if(e>=c.questions.length){R(!0),localStorage.removeItem("POLICE_PROQA_DATA");return}h(e),p(null),v(0)},[c,m]),Y=(0,d.useCallback)(function(e,t){let l=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(!c)return;let n=c.questions[m],r=null==n?void 0:n.answers[e];if(!n||!r)return;if(void 0!==r.goto){localStorage.removeItem("POLICE_PROQA_DATA"),localStorage.removeItem("POLICE_PROQA_ANSWERS"),h(0),p(null),v(0),b(""),A(0),I(!1),R(!1),T([]),q(""),H([]),i&&i(r.goto);return}if(r.vehicleInput&&!t){B(!0),$(e);return}if(r.personInput&&!t){M(!0),$(e);return}if(p(e),r.input&&!t){V(!0),$(e);return}let a=r.display;a=t?r.vehicleInput?r.display.replace("{vehicle}",t):r.personInput?r.display.replace("{person}",t):r.display.replace("{input}",t):r.display.replace("{input}",r.answer);let s={questionIndex:m,code:j,subCode:Q,plan:S,isCodeOverridden:E,answersLength:L.length},o=k(n.text),d={question:o,defaultQuestion:o,defaultAnswer:r.answer,answer:a,questionIndex:m,omit:n.omitQuestion||!1,timestamp:new Date().toISOString()},u=[...L],x=u.findIndex(e=>e.questionIndex===m);if(x>=0?u[x]=d:u.push(d),T(u),r.updateSubCode&&q(r.updateSubCode),r.dependency){console.log("Checking dependency with answers:",L);let e=(0,C.xV)(r.dependency,L);if(e){if(void 0!==e.goto){localStorage.removeItem("POLICE_PROQA_DATA"),localStorage.removeItem("POLICE_PROQA_ANSWERS"),h(0),p(null),v(0),b(""),A(0),I(!1),R(!1),T([]),q(""),i&&i(e.goto);return}e.code&&b(e.code),e.subCode&&q(e.subCode),e.plan&&A(e.plan),e.override&&I(!0)}}r.updateCode&&!E&&(r.override||D(r.updateCode,j))&&(b(r.updateCode),r.override&&I(!0));let f=[...z];if(f[m]=s,H(f),G(u),p(e),r.end){R(!0),localStorage.removeItem("POLICE_PROQA_DATA");return}(r.continue||l)&&!r.end&&Z()},[c,m,L,j,Q,S,E,z,i,Z,G]);if((0,d.useEffect)(()=>{let e=localStorage.getItem("POLICE_PROQA_DATA");if(!e)return;let l=JSON.parse(e);l.complaint===t&&(h(l.currentQuestion),b(l.currentCode||""),A(l.currentPlan),q(l.currentSubCode||""))},[t]),(0,d.useEffect)(()=>{if(!_)return;let e=j,t=localStorage.getItem("POLICE_PROQA_DATA"),n=t?JSON.parse(t):null;!e&&(null==n?void 0:n.currentCode)&&(e=n.currentCode),e&&"DEFAULT"!==e||(e=c?P(c):"DEFAULT"),l(e,e,Q||(null==n?void 0:n.currentSubCode)||""),R(!1)},[_,j,Q,S,l,c]),(0,d.useEffect)(()=>{let e=r.A.find(e=>e.name===t);e&&(u(e),A(e.defaultPlan),h(0),p(null),v(0),b(""),A(e.defaultPlan),I(!1),R(!1),T([]),q(""))},[t]),(0,d.useEffect)(()=>{let e=e=>{if(!c||K)return;let t=c.questions[m];if(!t||"select"!==t.questionType)return;let l=t.answers.length;"ArrowDown"===e.key?(e.preventDefault(),v(e=>(e+1)%l)):"ArrowUp"===e.key?(e.preventDefault(),v(e=>(e-1+l)%l)):"Enter"===e.key&&(e.preventDefault(),Y(g))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[c,m,g,K,Y]),(0,d.useEffect)(()=>{if(J.current){let e=J.current.querySelectorAll(".answer-option");e[g]&&e[g].scrollIntoView({behavior:"smooth",block:"nearest"})}},[g]),!c||_)return null;let X=c.questions[m];return X?(()=>{if(!c)return!1;let e=c.questions[m];return!!e&&(!e.preRenderInstructions||(0,C.U_)(e.preRenderInstructions,L,j))})()?(0,n.jsxs)(s.Zp,{className:"max-w-5xl mx-auto h-fit w-full",children:[(0,n.jsx)(s.aR,{children:(0,n.jsx)(s.ZB,{className:"text-2xl",children:"ProQA Questions"})}),(0,n.jsx)(s.Wu,{children:(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsxs)("h3",{className:"text-lg text-muted-foreground font-medium",children:["ProQA Protocol: ",c.name]}),(0,n.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Question ",m+1," of"," ",c.questions.length]})]}),(0,n.jsx)(s.Zp,{children:(0,n.jsxs)(s.Wu,{className:"p-6",children:[(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("h4",{className:"text-lg font-medium mb-4",children:X.text}),"select"===X.questionType?(0,n.jsx)("div",{ref:J,className:"space-y-2 overflow-y-auto",children:X.answers.filter(e=>!e.preRenderInstructions||(0,C.U_)(e.preRenderInstructions,L,j)).map((e,t)=>(0,n.jsx)("div",{onClick:()=>Y(t),className:(0,f.cn)("answer-option p-3 rounded-md transition-colors cursor-pointer",x===t?"bg-primary text-primary-foreground":g===t?"bg-green-500 text-white":"bg-muted hover:bg-muted/80"),children:e.answer},t))}):"input"===X.questionType&&(0,n.jsx)("form",{onSubmit:e=>{e.preventDefault();let t=e.currentTarget.querySelector("input");t&&t.value&&(Y(0,t.value),t.value="")},children:(0,n.jsx)(y.p,{placeholder:X.answers[0].answer,autoFocus:!0})})]}),m>0&&(0,n.jsx)("div",{className:"flex justify-end mt-4",children:(0,n.jsx)(a.$,{variant:"outline",onClick:()=>{if(m>0){let e=m-1,t=z[m];t&&(b(t.code),q(t.subCode),A(t.plan),I(t.isCodeOverridden),T(L.filter(e=>e.questionIndex<m))),h(e),p(null),v(0),G(L.filter(e=>e.questionIndex<m))}else o()},className:"text-sm",children:"Back"})})]})})]})}),(0,n.jsx)(N.M,{isOpen:K,onClose:()=>{V(!1),$(null),p(null)},onSubmit:e=>{V(!1),$(null),null!==W&&Y(W,e)},title:X?k(X.text):""}),(0,n.jsx)(w,{isOpen:U,onClose:()=>{B(!1),$(null),p(null)},onSubmit:e=>{null!==W&&(B(!1),$(null),Y(W,e,!0))},title:X?k(X.text):""}),(0,n.jsx)(O,{isOpen:F,onClose:()=>{M(!1),$(null),p(null)},onSubmit:e=>{null!==W&&(M(!1),$(null),Y(W,e,!0))},title:X?k(X.text):""})]}):(Z(),null):(R(!0),null)}var _=l(7746),R=l(4865),L=l(5695);function T(){let e=(0,L.useRouter)(),[t,l]=(0,d.useState)({postal:"",street:"",buildingInfo:"",crossStreet1:"",crossStreet2:"",callerName:"",callerNumber:"",callerText:"",service:"Police"}),[a,s]=(0,d.useState)({chiefComplaint:""}),[o,i]=(0,d.useState)(1),[c,u]=(0,d.useState)(""),[m,h]=(0,d.useState)("");(0,d.useEffect)(()=>{let t=localStorage.getItem("NEW_CALL");if(!t)return e.push("/create-call");let n=JSON.parse(t);if(!n||"Police"!==n.service)return e.push("/create-call");l(n)},[e]);let p=()=>{o>1?i(o-1):e.push("/create-call")},f=()=>{let e=localStorage.getItem("POLICE_PROQA_ANSWERS");if(e)return JSON.parse(e)},g=(e,t)=>{let l=["O","A","B","C","D","E"],n=e.charAt(3),r=t.charAt(3);return l.indexOf(n)<l.indexOf(r)},v=async(l,n,a)=>{var s,o;let i=await f();localStorage.removeItem("POLICE_PROQA_DATA"),localStorage.removeItem("POLICE_PROQA_ANSWERS");let d=localStorage.getItem("PREFERENCES");if((d?JSON.parse(d):{}).advancedMode){let o={...t,complaint:c,complaintShort:null==(s=r.A.find(e=>e.name===c))?void 0:s.shortName,code:l,codeText:a,plan:n,proqaAnswers:i,timestamp:new Date().toISOString()};localStorage.setItem("PENDING_ASSIGN_POLICE",JSON.stringify(o)),e.push("/assign/police")}else{let s={...t,complaint:c,complaintShort:null==(o=r.A.find(e=>e.name===c))?void 0:o.shortName,code:l,codeText:a,plan:n,proqaAnswers:i,timestamp:new Date().toISOString(),units:["Pending"],dispatchTime:new Date().toISOString()};localStorage.setItem("DISPATCH_HISTORY",JSON.stringify(s)),e.push("/summary/police")}};return(0,n.jsxs)("div",{className:"flex flex-col min-h-screen",children:[(0,n.jsx)(R.A,{}),(0,n.jsxs)("main",{className:"w-full flex justify-center flex-1 mt-12",children:[1===o&&(0,n.jsx)(x,{onContinue:(e,t,l)=>(s(t),u(e),i(l?3:2)),handleBack:p}),2===o&&(0,n.jsx)(I,{policeData:a,complaintName:c,onComplete:(e,t,l)=>{let n=t&&l?"".concat(t).concat(l):e;(!m||g(n,m))&&h(n),n&&"DEFAULT"!==n&&i(3)},onBack:p,onSwitchProtocol:e=>{let l=r.A.find(t=>t.protocol===e);l&&(t.reconfigured=c,localStorage.removeItem("POLICE_PROQA_DATA"),localStorage.removeItem("POLICE_PROQA_QUESTIONS"),u(l.name))}}),3===o&&(0,n.jsx)(b,{complaintName:c,recommendedCode:m,onSelect:v,onBack:p})]}),(0,n.jsx)(_.A,{})]})}},5516:(e,t,l)=>{"use strict";l.d(t,{DD:()=>function e(t,l){if("string"==typeof t)return t.replace(/\*\*pronoun\*\*/g,l);if(Array.isArray(t))return t.map((t,a)=>(0,n.jsx)(r.Fragment,{children:e(t,l)},a));if((0,r.isValidElement)(t)){let n=e(t.props.children,l);return r.cloneElement(t,{...t.props},n)}return t},U8:()=>a,U_:()=>s,xT:()=>o,xV:()=>i});var n=l(5155),r=l(2115);function a(e,t,l,n){if(!e)return!0;try{return e(t,l,n)}catch(e){return console.error("Error evaluating pre-render instructions:",e),!0}}function s(e,t,l){if(!e)return!0;try{return e(t,l)}catch(e){return console.error("Error evaluating pre-render instructions:",e),!0}}function o(e,t,l){if(e)try{return e(t,l)}catch(e){console.error("Error evaluating dependencies:",e);return}}function i(e,t){if(e)try{return e(t)}catch(e){console.error("Error evaluating dependencies:",e);return}}},6645:(e,t,l)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r}});let n=l(8229)._(l(7357));function r(e,t){var l;let r={};"function"==typeof e&&(r.loader=e);let a={...r,...t};return(0,n.default)({...a,modules:null==(l=a.loadableGenerated)?void 0:l.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},6766:(e,t,l)=>{"use strict";l.d(t,{default:()=>r.a});var n=l(1469),r=l.n(n)},7357:(e,t,l)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i}});let n=l(5155),r=l(2115),a=l(2146);function s(e){return{default:e&&"default"in e?e.default:e}}l(255);let o={loader:()=>Promise.resolve(s(()=>null)),loading:null,ssr:!0},i=function(e){let t={...o,...e},l=(0,r.lazy)(()=>t.loader().then(s)),i=t.loading;function c(e){let s=i?(0,n.jsx)(i,{isLoading:!0,pastDelay:!0,error:null}):null,o=!t.ssr||!!t.loading,c=o?r.Suspense:r.Fragment,d=t.ssr?(0,n.jsxs)(n.Fragment,{children:[null,(0,n.jsx)(l,{...e})]}):(0,n.jsx)(a.BailoutToCSR,{reason:"next/dynamic",children:(0,n.jsx)(l,{...e})});return(0,n.jsx)(c,{...o?{fallback:s}:{},children:d})}return c.displayName="LoadableComponent",c}},8996:(e,t,l)=>{"use strict";l.d(t,{M:()=>i});var n=l(5155),r=l(7168),a=l(9840),s=l(9852),o=l(2115);function i(e){let{isOpen:t,onClose:l,onSubmit:i,title:c}=e,[d,u]=(0,o.useState)(""),m=e=>{e.preventDefault(),d.trim()&&(i(d.trim()),u(""),l())};return(0,n.jsx)(a.lG,{open:t,onOpenChange:l,children:(0,n.jsxs)(a.Cf,{children:[(0,n.jsx)(a.c7,{children:(0,n.jsx)(a.L3,{children:c})}),(0,n.jsxs)("form",{onSubmit:m,children:[(0,n.jsx)(s.p,{value:d,onChange:e=>u(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),m(e))},placeholder:"Enter description...",autoFocus:!0}),(0,n.jsx)(a.Es,{className:"mt-4",children:(0,n.jsx)(r.$,{type:"submit",children:"Ok"})})]})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[4619,6580,9726,4977,8045,7423,5916,3631,8441,1684,7358],()=>t(2305)),_N_E=e.O()}]);